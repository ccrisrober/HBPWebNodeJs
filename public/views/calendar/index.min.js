!function(){"use strict";app=app||{},app.CalendarModel=Backbone.Collection.extend({model:app.EventModel,url:"/events",comparator:function(a,b){return a.start().isAfter(b.start())},onDate:function(a){return new app.CalendarModel(this.filter(function(b){return b.start().isSame(a,"day")}))}}),app.EventModel=Backbone.Model.extend({start:function(){return moment(this.get("date")+" "+this.get("startTime"))},hours:function(){for(var a=[],b=this.start(),c=this.end();b.isBefore(c);)a.push(b.format("h:mm A")),b.add(1,"hour");return a},end:function(){var a=moment(this.get("date")+" "+this.get("endTime"));return"00:00"===this.get("endTime")&&a.add(1,"day"),a},validate:function(a){if(a.collection){var b=_.flatten(a.collection.invoke("hours")),c=this.hours().map(function(a){return b.indexOf(a)}).filter(function(a){return a>-1}).length;if(this.unset("collection"),c>0)return"You already have an event at that time."}}}),app.MonthModel=Backbone.Model.extend({defaults:{year:moment().year(),month:moment().month()},initialize:function(){var a=this.moment();this.set("name",a.format("MMMM")),this.set("days",a.daysInMonth()),this.set("weeks",Math.ceil((this.get("days")+a.day())/7))},moment:function(){return moment([this.get("year"),this.get("month")])},weekDates:function(a){var b=7,c=[],d=this.moment().day();0===a&&(b-=d,d=0);for(var e=7*a+1-d,f=e+b;f>e;e++)e>this.get("days")||c.push(e);return c}}),app.Router=Backbone.Router.extend({initialize:function(a){this.main=a.main,this.calendar=a.calendar},routes:{"":"month",":year/:month":"month",":year/:month/:day":"day"},month:function(a,b){var c=this.clean(a,b);this.main.html(new app.MonthView({collection:this.calendar,model:new app.MonthModel({year:c[0],month:c[1]})}).render().el)},clean:function(a,b,c){console.log(moment().format());var d=moment();return a=parseInt(a,10)||d.year(),b=b?(parseInt(b,10)-1)%12:d.month(),c=parseInt(c,10)||d.day(),[a,b,c]},day:function(a,b,c){var d=moment(this.clean(a,b,c));this.main.html(new app.DayView({date:d,collection:this.calendar}).render().el)}}),app.DayView=Backbone.View.extend({template:_.template($("#tmpl-viewday").html()),initialize:function(a){this.date=a.date,this.listenTo(this.collection,"hover",this.showDetails)},events:{"click .back":"backToMonth"},render:function(){this.el.innerHTML=this.template({date:this.date.format("MMMM D, YYYY")}),this.$("div").append(new app.DayTableView({date:this.date,collection:this.collection}).render().el);var a=this.$("div").append("<div>");return this.details=new app.ViewDetails,a.append(this.details.el),a.append(new app.CreateEventView({date:this.date.format("YYYY-MM-DD"),collection:this.collection}).render().el),this},backToMonth:function(){Backbone.history.navigate(this.date.format("/YYYY/MM"),{trigger:!0})},showDetails:function(a){this.details.changeModel(a)}}),app.MonthView=Backbone.View.extend({template:_.template($("#tmpl-month").html()),events:{"click .prev":"prev","click .next":"next"},render:function(){this.$el.html(this.template(this.model.toJSON()));for(var a=this.model.get("weeks"),b=0;a>b;b++)this.$("tbody").append(new app.WeekRow({week:b,model:this.model,collection:this.collection}).render().el);return this},prev:function(){var a=this.model.moment().subtract(1,"month").format("YYYY/MM");Backbone.history.navigate(a,{trigger:!0})},next:function(){var a=this.model.moment().add(1,"month").format("YYYY/MM");Backbone.history.navigate(a,{trigger:!0})}}),app.DayTableView=Backbone.View.extend({tagName:"table",className:"day",template:_.template($("#tmpl-dayTable").html()),events:{"mouseover tr.highlight td.event":"hover","mouseout tr.highlight td.event":"hover"},initialize:function(a){this.date=a.date,this.listenTo(this.collection,"add",this.addEvent),this.listenTo(this.collection,"destroy",this.destroyEvent),this.hours={}},render:function(){this.el.innerHTML=this.template();for(var a=0;24>a;a++){var b=moment(a,"H").format("h:mm A");this.hours[b]=new app.ViewHour({time:b}),this.$("tbody").append(this.hours[b].render().el)}return this.collection.onDate(this.date).forEach(this.addEvent,this),this},addEvent:function(a){a.hours().forEach(function(b){this.hours[b].displayEvent(a)},this)},destroyEvent:function(a){a.hours().forEach(function(a){this.hours[a].removeEvent()},this)},hover:function(a){var b=parseInt(a.currentTarget.getAttribute("data-id"),10),c=this.collection.get(b);c.hours().forEach(function(a){this.hours[a].hover()},this),this.collection.trigger("hover",c)}}),app.ViewHour=Backbone.View.extend({tagName:"tr",template:_.template($("#tmpl-hour").html()),initialize:function(a){this.time=a.time},render:function(){return this.el.innerHTML=this.template({time:this.time}),this},displayEvent:function(a){this.$el.addClass("highlight"),this.$(".event").attr("data-id",a.get("id")),this.$(".event").text(a.get("title"))},removeEvent:function(){this.$el.removeClass("highlight"),this.$(".event").removeAttr("data-id"),this.$(".event").text("")},hover:function(){this.$el.toggleClass("hover")}}),app.WeekRow=Backbone.View.extend({tagName:"tr",initialize:function(a){a&&(this.week=a.week)},render:function(){var a=this.model;if(0===this.week)for(var b=a.moment().day(),c=0;b>c;c++)this.$el.append("<td>");return a.weekDates(this.week).forEach(function(b){b=a.moment().date(b),this.$el.append(new app.DayCellView({model:b,collection:this.collection.onDate(b)}).render().el)},this),this}}),app.DayCellView=Backbone.View.extend({tagName:"td",template:_.template($("#tmpl-day").html()),events:{click:"switchToDayView"},render:function(){return this.$el.html(this.template({num:this.model.date(),titles:this.collection.pluck("title")})),this},switchToDayView:function(){Backbone.history.navigate(this.model.format("YYYY/MM/DD"),{trigger:!0})}}),app.ViewDetails=Backbone.View.extend({template:_.template($("#tmpl-details").html()),events:{"click button":"delete"},initialize:function(){this.data={title:"Hover over an event to see details",start:""},this.render()},render:function(){return this.el.innerHTML=this.template(this.data),this},changeModel:function(a){this.model=a;var b=this.model.start(),c=this.model.end();return this.data={title:a.get("title"),start:b.format("h:mm A"),end:c.format("h:mm A"),duration:c.diff(b,"hour")+" hours"},this.render()},"delete":function(){this.model.destroy()}}),app.CreateEventView=Backbone.View.extend({tagName:"form",template:_.template($("#tmpl-createEvent").html()),initialize:function(a){this.date=a.date},events:{"click button":"createEvent"},render:function(){return this.el.innerHTML=this.template(),this},createEvent:function(a){a.preventDefault();var b=new app.EventModel({collection:this.collection.onDate(this.date),title:this.$("#eventTitle").val(),date:this.date,startTime:this.$("#eventStartTime").val(),endTime:this.$("#eventEndTime").val()});return b.isValid()?(this.collection.create(b,{wait:!0}),this.el.reset(),this.$(".error").text("")):this.$(".error").text(b.validationError),!1}}),$(document).ready(function(){app.router=new app.Router({main:$("#main"),calendar:new app.CalendarModel([{title:"sdfsdf",date:"2014-11-01",startTime:"00:02",endTime:"13:01",id:1},{title:"ghg",date:"2014-11-01",startTime:"01:00",endTime:"02:00",id:2},{title:"gfhfgh",date:"2014-11-01",startTime:"14:02",endTime:"02:03",id:3},{title:"dfgdfg",date:"2014-11-01",startTime:"11:11",endTime:"00:11",id:4},{title:"adfsdfsdf",date:"2014-11-01",startTime:"02:00",endTime:"03:00",id:5},{title:"vvvv",date:"2014-11-01",startTime:"23:59",endTime:"12:00",id:6},{title:"fdfg",date:"2014-11-01",startTime:"",endTime:"",id:7},{title:"gdfgdfg",date:"2014-11-01",startTime:"03:01",endTime:"04:00",id:8},{title:"dfsdf",date:"2014-12-01",startTime:"01:00",endTime:"01:01",id:9},{title:"XD",date:"2014-12-01",startTime:"08:00",endTime:"09:00",id:10}])}),Backbone.history.start()})}();
//# sourceMappingURL=index.min.js.map